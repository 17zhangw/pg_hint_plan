LOAD 'pg_hint_plan';
SET pg_hint_plan.debug_print TO on;
SET client_min_messages TO LOG;
--
-- IndexOnlyScan hint test
--
-- 1.ヒントつきクエリとの比較用
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
      QUERY PLAN       
-----------------------
 Seq Scan on ti1 t_1
   Filter: (c2 < 1000)
(2 rows)

-- 2.テーブルを指定、1と比較
/*+IndexOnlyScan(ti1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(ti1)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1
   Filter: (c2 < 1000)
(2 rows)

-- 3.エイリアスを指定、1と比較
/*+IndexOnlyScan(t_1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(t_1)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1 t_1
   Filter: (c2 < 1000)
(2 rows)

-- 4.インデックスを指定、1と比較
/*+IndexOnlyScan(ti1_i2)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(ti1_i2)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1
   Filter: (c2 < 1000)
(2 rows)

-- 5.エイリアスとインデックスを指定・指定したインデックスを使用、2と比較
/*+IndexOnlyScan(t_1 ti1_i2)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(t_1 ti1_i2)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1 t_1
   Filter: (c2 < 1000)
(2 rows)

-- 6.エイリアス1つとインデックス2つを指定、2つ目のインデックスを使用、5と比較
/*+IndexOnlyScan(t_1 ti1_i2 ti1_i1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(t_1 ti1_i2 ti1_i1)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1 t_1
   Filter: (c2 < 1000)
(2 rows)

-- 7.Index ScanとIndex Only Scanの両方で使用しないようなインデックスを指定、
--   5と比較
/*+IndexOnlyScan(t_1 ti1_pred)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(t_1 ti1_pred)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1 t_1
   Filter: (c2 < 1000)
(2 rows)

-- 8.存在しないインデックスを指定
/*+IndexOnlyScan(t_1 ti1_i)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
INFO:  hint syntax error at or near "IndexOnlyScan(t_1 ti1_i)"
DETAIL:  Unrecognized hint keyword "IndexOnlyScan".
      QUERY PLAN       
-----------------------
 Seq Scan on ti1 t_1
   Filter: (c2 < 1000)
(2 rows)

--
-- IndexScan hint test
--
-- 1.IndexScanヒントが今までどおり使えることの確認
/*+IndexScan(t_1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 1000;
LOG:  pg_hint_plan:
used hint:
IndexScan(t_1)
not used hint:
duplication hint:
error hint:

             QUERY PLAN             
------------------------------------
 Index Scan using ti1_i1 on ti1 t_1
   Index Cond: (c2 < 1000)
(2 rows)

--
-- NoIndexOnlyScan hint test
--
-- 1.ヒントつきクエリとの比較用
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 10;
             QUERY PLAN             
------------------------------------
 Index Scan using ti1_i1 on ti1 t_1
   Index Cond: (c2 < 10)
(2 rows)

-- 2.テーブルを指定、1と比較
/*+NoIndexOnlyScan(ti1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 WHERE c2 < 10;
INFO:  hint syntax error at or near "NoIndexOnlyScan(ti1)"
DETAIL:  Unrecognized hint keyword "NoIndexOnlyScan".
           QUERY PLAN           
--------------------------------
 Index Scan using ti1_i1 on ti1
   Index Cond: (c2 < 10)
(2 rows)

-- 3.エイリアスを指定、1と比較
/*+NoIndexOnlyScan(t_1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 10;
INFO:  hint syntax error at or near "NoIndexOnlyScan(t_1)"
DETAIL:  Unrecognized hint keyword "NoIndexOnlyScan".
             QUERY PLAN             
------------------------------------
 Index Scan using ti1_i1 on ti1 t_1
   Index Cond: (c2 < 10)
(2 rows)

-- 4.インデックスを指定、1と比較
/*+NoIndexOnlyScan(ti1_i2)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 WHERE c2 < 10;
INFO:  hint syntax error at or near "NoIndexOnlyScan(ti1_i2)"
DETAIL:  Unrecognized hint keyword "NoIndexOnlyScan".
           QUERY PLAN           
--------------------------------
 Index Scan using ti1_i1 on ti1
   Index Cond: (c2 < 10)
(2 rows)

-- 5.エイリアスとインデックスを指定、2と比較
/*+NoIndexOnlyScan(t_1 ti1_i1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 10;
INFO:  hint syntax error at or near "NoIndexOnlyScan(t_1 ti1_i1)"
DETAIL:  Unrecognized hint keyword "NoIndexOnlyScan".
             QUERY PLAN             
------------------------------------
 Index Scan using ti1_i1 on ti1 t_1
   Index Cond: (c2 < 10)
(2 rows)

--
-- NoIndexScan hint test
--
-- 1.Index ScanだけでなIndex Only Scanも選択されないことの確認
/*+NoIndexScan(t_1)*/
EXPLAIN (COSTS false) SELECT c2 FROM s1.ti1 t_1 WHERE c2 < 10;
LOG:  pg_hint_plan:
used hint:
NoIndexScan(t_1)
not used hint:
duplication hint:
error hint:

            QUERY PLAN             
-----------------------------------
 Bitmap Heap Scan on ti1 t_1
   Recheck Cond: (c2 < 10)
   ->  Bitmap Index Scan on ti1_i2
         Index Cond: (c2 < 10)
(4 rows)

